<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coding Crabs - Smooth Scroll Gallery</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
  <script src="https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>
  <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>
  
  <style>
    /* === SMOOTH SCROLL & PRELOADER STYLES === */
    html, body {
      height: 100%;
      overflow: hidden;
    }

    .lenis {
      height: auto;
    }

    .lenis-smooth {
      scroll-behavior: auto;
    }

    .lenis-stopped {
      overflow: hidden;
    }

    .loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
      color: white;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity 0.8s ease, transform 0.8s ease;
    }

    .loader-content {
      text-align: center;
      padding: 2rem;
      max-width: 90vw;
    }

    .loader-visual {
      position: relative;
      width: clamp(120px, 30vw, 200px);
      height: clamp(120px, 30vw, 200px);
      margin: 0 auto 2rem;
    }

    .progress-circle {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .progress-bg {
      fill: none;
      stroke: rgba(255, 255, 255, 0.1);
      stroke-width: 8;
    }

    .progress-bar {
      fill: none;
      stroke: #87cd33;
      stroke-width: 8;
      stroke-linecap: round;
      stroke-dasharray: 565.48;
      stroke-dashoffset: 565.48;
      transition: stroke-dashoffset 0.3s ease;
    }

    .crab-icon {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: clamp(2rem, 5vw, 3.5rem);
      animation: crabFloat 2s ease-in-out infinite;
    }

    @keyframes crabFloat {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.1); }
    }

    .loader-text h1 {
      font-size: clamp(1.8rem, 5vw, 3rem);
      font-weight: 600;
      margin-bottom: 0.5rem;
      letter-spacing: 0.1em;
    }

    .loader-text h2 {
      font-size: clamp(1.2rem, 4vw, 2rem);
      font-weight: 400;
      color: #87cd33;
    }

    .dots::after {
      content: '';
      animation: dots 1.5s steps(4, end) infinite;
    }

    @keyframes dots {
      0% { content: ''; }
      25% { content: '.'; }
      50% { content: '..'; }
      75%, 100% { content: '...'; }
    }

    .loader.fade-out {
      opacity: 0;
      transform: scale(0.95);
      pointer-events: none;
    }

    /* === MAIN STYLES === */
    :root { font-size: 16px; }
    @media (max-width: 500px) { :root { font-size: 14px; } }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;
      background: #f0f0f0;
      will-change: scroll-position;
    }

    h1 { font-size: 5rem; }
    h2 { font-size: 2rem; }

    img {
      width: 300px;
      height: auto;
      background: #f0f0f0;
      object-fit: cover;
      will-change: transform;
    }

    ul {
      padding-left: 1rem;
      list-style: none;
    }

    li {
      flex-shrink: 0;
      width: clamp(500px, 60vw, 800px);
      padding-right: 1rem;
      will-change: transform;
    }

    header { height: 100vh; }
    footer { height: 50vh; }

    :any-link { color: #4e9815; }

    .df { display: flex; }
    .aic { align-items: center; }
    .jcc { justify-content: center; }

    .demo-wrapper {
      overflow-x: hidden;
    }

    .wrapper {
      display: flex;
      will-change: transform;
    }

    .demo-gallery:not(.last) {
      padding-bottom: 1rem;
    }

    .demo-text .text {
      font-size: clamp(6rem, 8vw, 10rem);
      line-height: 1;
      font-weight: 500;
    }

    nav {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 80px;
      background-color: rgba(33, 33, 33, 0.8);
      backdrop-filter: blur(10px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      font-size: 50px;
      font-weight: bolder;
      color: white;
    }

    model-viewer {
      width: 100%;
      max-width: 500px;
      height: 400px;
      margin: 0 auto;
      display: block;
    }

    model-viewer::part(overlay) {
      background-color: rgba(0, 0, 0, 0.5);
    }

    ::-webkit-scrollbar {
      display: none;
    }

    /* Mobile responsive adjustments */
    @media (max-width: 768px) {
      h1 { font-size: 3rem; }
      h2 { font-size: 1.5rem; }
      nav { font-size: 30px; height: 60px; }
      model-viewer { max-width: 300px; height: 300px; }
    }
  </style>
</head>
<body>
  <!-- Preloader -->
  <div class='loader'>
    <div class="loader-content">
      <div class="loader-visual">
        <svg class="progress-circle" viewBox="0 0 200 200">
          <circle class="progress-bg" cx="100" cy="100" r="90"></circle>
          <circle class="progress-bar" cx="100" cy="100" r="90"></circle>
        </svg>
        <div class="crab-icon">ðŸ¦€</div>
      </div>
      <div class="loader-text">
        <h1>Loading<span class="dots"></span></h1>
        <h2 class='loader--text'>0%</h2>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <nav>
    <div>Coding Crabs ðŸ¦€</div>
  </nav>

  <div class='demo-wrapper'>
    <header class='df aic jcc'>
      <div>
        <h1>Coding Crabs ðŸ¦€</h1>
        <h2>scroll down for the image-gallery</h2>
        <!-- WORKING 3D MODEL -->
        <model-viewer 
          src="main.glb" 
          autoplay 
          camera-controls
          disable-zoom 
          shadow-intensity="1" 
          loop
          alt="A 3D astronaut model">
        </model-viewer>
      </div>
    </header>

    <section class='demo-text'>
      <div class='wrapper text'>
        This_is_a_demo_for_GSAP's_ScrollTrigger_plugin.
      </div>
    </section>

    <!-- OPTIMIZED IMAGE GALLERY -->
    <section class='demo-gallery'>
      <ul class='wrapper'>
        <li><img src='https://images.unsplash.com/photo-1540206395-68808572332f?w=800&h=600&fit=crop&auto=format&q=80' alt='Tropical jungle' loading='lazy' width='800' height='600'></li>
        <li><img src='https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&h=600&fit=crop&auto=format&q=80' alt='Mountain landscape' loading='lazy' width='800' height='600'></li>
        <li><img src='https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop&auto=format&q=80' alt='Tuscany hills' loading='lazy' width='800' height='600'></li>
        <li><img src='https://images.unsplash.com/photo-1519904981063-b0cf448d479e?w=800&h=600&fit=crop&auto=format&q=80' alt='Foggy forest' loading='lazy' width='800' height='600'></li>
      </ul>
    </section>

    <section class='demo-gallery'>
      <ul class='wrapper'>
        <li><img src='https://images.unsplash.com/photo-1501594907352-04cda38ebc29?w=800&h=600&fit=crop&auto=format&q=80' alt='Golden gate view' loading='lazy' width='800' height='600'></li>
        <li><img src='https://images.unsplash.com/photo-1439853949127-fa647821eba0?w=800&h=600&fit=crop&auto=format&q=80' alt='Mountain lake' loading='lazy' width='800' height='600'></li>
        <li><img src='https://images.unsplash.com/photo-1494500764479-0c8f2919a3d8?w=800&h=600&fit=crop&auto=format&q=80' alt='Sunset mountains' loading='lazy' width='800' height='600'></li>
      </ul>
    </section>

    <section class='demo-gallery'>
      <ul class='wrapper'>
        <li><img src='https://images.unsplash.com/photo-1506197603052-3cc9c3a201bd?w=800&h=600&fit=crop&auto=format&q=80' alt='Boats on lake' loading='lazy' width='800' height='600'></li>
        <li><img src='https://images.unsplash.com/photo-1505142468610-359e7d316be0?w=800&h=600&fit=crop&auto=format&q=80' alt='Ocean coast' loading='lazy' width='800' height='600'></li>
        <li><img src='https://images.unsplash.com/photo-1473448912268-2022ce9509d8?w=800&h=600&fit=crop&auto=format&q=80' alt='Alpine lake' loading='lazy' width='800' height='600'></li>
        <li><img src='https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=800&h=600&fit=crop&auto=format&q=80' alt='Countryside' loading='lazy' width='800' height='600'></li>
      </ul>
    </section>

    <section class='demo-gallery'>
      <ul class='wrapper'>
        <li><img src='https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=800&h=600&fit=crop&auto=format&q=80' alt='Forest landscape' loading='lazy' width='800' height='600'></li>
        <li><img src='https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=800&h=600&fit=crop&auto=format&q=80' alt='Mountain valley' loading='lazy' width='800' height='600'></li>
        <li><img src='https://images.unsplash.com/photo-1426604966848-d7adac402bff?w=800&h=600&fit=crop&auto=format&q=80' alt='Nature scene' loading='lazy' width='800' height='600'></li>
      </ul>
    </section>

    <section class='demo-text'>
      <div class='wrapper text'>
        This_is_a_demo_for_GSAP's_ScrollTrigger_plugin.
      </div>
    </section>

    <footer class='df aic jcc'>
      <p>Images from <a href="https://unsplash.com/">Unsplash</a></p>
      <!-- WORKING 3D MODEL -->
      <model-viewer 
        src="https://modelviewer.dev/shared-assets/models/RobotExpressive.glb" 
        autoplay 
       
        disable-zoom  
        shadow-intensity="1" 
        loop
        alt="A 3D robot model">
      </model-viewer>
    </footer>
  </div>

  <script>
    // Initialize Lenis for smooth scrolling
    const lenis = new Lenis({
      duration: 1.2,
      easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
      smooth: true,
      smoothTouch: false,
      touchMultiplier: 2,
    });

    function raf(time) {
      lenis.raf(time);
      requestAnimationFrame(raf);
    }
    requestAnimationFrame(raf);

    // GSAP and ScrollTrigger setup
    gsap.registerPlugin(ScrollTrigger);

    lenis.on('scroll', ScrollTrigger.update);

    ScrollTrigger.scrollerProxy(document.body, {
      scrollTop(value) {
        if (arguments.length) {
          lenis.scrollTo(value);
        }
        return lenis.scroll;
      },
      getBoundingClientRect() {
        return { top: 0, left: 0, width: window.innerWidth, height: window.innerHeight };
      },
      pinType: document.body.style.transform ? "transform" : "fixed"
    });

    const imageElements = gsap.utils.toArray('img');
    const loaderTextElement = document.querySelector('.loader--text');
    const progressBar = document.querySelector('.progress-bar');
    const loader = document.querySelector('.loader');

    const radius = 90;
    const circumference = 2 * Math.PI * radius;

    const updateProgress = (instance) => {
      const progress = Math.round(instance.progressedCount * 100 / imageElements.length);
      loaderTextElement.textContent = `${progress}%`;
      const offset = circumference - (progress / 100) * circumference;
      progressBar.style.strokeDashoffset = offset;
    };

    const showDemo = () => {
      gsap.to(loader, {
        opacity: 0,
        scale: 0.95,
        duration: 0.8,
        ease: "power2.inOut",
        onComplete: () => {
          loader.style.display = 'none';
          document.body.style.overflow = 'auto';
        }
      });

      gsap.from("header", {
        opacity: 0,
        y: 50,
        duration: 1,
        delay: 0.3,
        ease: "power2.out"
      });

      gsap.utils.toArray('section').forEach((section, index) => {
        const w = section.querySelector('.wrapper');
        const [x, xEnd] = (index % 2)
          ? ['100%', (w.scrollWidth - section.offsetWidth) * -1]
          : [w.scrollWidth * -1, 0];

        gsap.fromTo(w, { x }, {
          x: xEnd,
          scrollTrigger: {
            trigger: section,
            scroller: document.body,
            scrub: 0.3,
            start: "top bottom",
            end: "bottom top",
            ease: "none",
            invalidateOnRefresh: true,
          }
        });
      });

      ScrollTrigger.refresh();
    };

    progressBar.style.strokeDasharray = circumference;
    progressBar.style.strokeDashoffset = circumference;

    gsap.from(".loader-content", {
      opacity: 0,
      scale: 0.8,
      duration: 0.6,
      ease: "back.out(1.7)"
    });

    gsap.from(".crab-icon", {
      rotation: -180,
      duration: 1,
      ease: "power2.out",
      delay: 0.2
    });

    imagesLoaded(imageElements).on('progress', updateProgress).on('always', showDemo);
  </script>
</body>
</html>